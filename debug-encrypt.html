<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔒 加密测试页面</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .debug-info {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .info { color: #007bff; }
  </style>
</head>
<body>
  <h1>🔒 加密系统测试页面</h1>

  <div class="debug-info">
    <h3>🔍 调试信息</h3>
    <div id="debug-log"></div>
  </div>

  <div class="debug-info">
    <h3>🔐 密码测试</h3>
    <input type="password" id="testPassword" placeholder="输入测试密码" style="width: 200px; padding: 8px; margin: 5px;">
    <button onclick="testEncryption()" style="padding: 8px 15px; margin: 5px;">测试解密</button>
    <div id="test-result"></div>
  </div>

  <script>
    const debugLog = document.getElementById('debug-log');
    const testResult = document.getElementById('test-result');

    function addLog(message, type = 'info') {
      const logEntry = document.createElement('div');
      logEntry.className = type;
      logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      debugLog.appendChild(logEntry);
      console.log(message);
    }

    // 测试配置（从实际加密页面复制）
    const CONFIG = {
      encryptedContent: `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`,
      iv: 'R7NTHazlPUSciblN',
      maxRetries: 3
    };

    // 初始化检查
    addLog('🔍 开始初始化加密系统测试...');

    // 检查CryptoJS
    if (typeof CryptoJS !== 'undefined') {
      addLog('✅ CryptoJS 库加载成功', 'success');
    } else {
      addLog('❌ CryptoJS 库加载失败', 'error');
      return;
    }

    // 检查配置
    if (CONFIG && CONFIG.encryptedContent && CONFIG.iv) {
      addLog('✅ 加密配置加载成功', 'success');
      addLog(`📝 加密内容长度: ${CONFIG.encryptedContent.length} 字符`);
    } else {
      addLog('❌ 加密配置加载失败', 'error');
      return;
    }

    // 密码填充函数
    function padKeyTo32Bytes(key) {
      if (key.length >= 32) {
        return key.substring(0, 32);
      }
      let paddedKey = key;
      while (paddedKey.length < 32) {
        paddedKey += key;
      }
      return paddedKey.substring(0, 32);
    }

    // 测试解密函数
    window.testEncryption = function() {
      const inputPassword = document.getElementById('testPassword').value;

      if (!inputPassword) {
        testResult.innerHTML = '<span class="error">请输入密码</span>';
        return;
      }

      addLog(`🔐 尝试解密，密码长度: ${inputPassword.length}`);

      try {
        const paddedKey = padKeyTo32Bytes(inputPassword);
        const key = CryptoJS.enc.Utf8.parse(paddedKey);
        const iv = CryptoJS.enc.Utf8.parse(CONFIG.iv);

        const decrypted = CryptoJS.AES.decrypt(
          CONFIG.encryptedContent,
          key,
          { iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
        );

        const decryptedStr = CryptoJS.enc.Utf8.stringify(decrypted);

        if (decryptedStr && decryptedStr.trim() !== '') {
          testResult.innerHTML = `<span class="success">✅ 解密成功！内容长度: ${decryptedStr.length} 字符</span>`;
          addLog(`✅ 解密成功，解密内容长度: ${decryptedStr.length} 字符`, 'success');

          // 显示前100个字符
          addLog(`📄 解密内容预览: ${decryptedStr.substring(0, 100)}...`);
        } else {
          testResult.innerHTML = '<span class="error">❌ 解密失败：密码错误或内容为空</span>';
          addLog('❌ 解密失败：密码错误或内容为空', 'error');
        }
      } catch (error) {
        testResult.innerHTML = `<span class="error">❌ 解密异常: ${error.message}</span>`;
        addLog(`❌ 解密异常: ${error.message}`, 'error');
      }
    };

    addLog('🎯 初始化完成，可以开始测试解密功能', 'info');
  </script>
</body>
</html>