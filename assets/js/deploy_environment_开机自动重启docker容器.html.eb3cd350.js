"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[5213],{5726:(s,i)=>{i.A=(s,i)=>{const e=s.__vccOpts||s;for(const[s,a]of i)e[s]=a;return e}},7462:(s,i,e)=>{e.r(i),e.d(i,{comp:()=>h,data:()=>l});var a=e(362);const n={},h=(0,e(5726).A)(n,[["render",function(s,i){return(0,a.uX)(),(0,a.CE)("div",null,[...i[0]||(i[0]=[(0,a.Fv)('<h2 id="设置开机自动重启所有-docker-容器" tabindex="-1"><a class="header-anchor" href="#设置开机自动重启所有-docker-容器"><span>设置开机自动重启所有 Docker 容器</span></a></h2><p>在 CentOS 系统上设置开机后自动重启所有 Docker 容器，可以通过以下几种方式实现：</p><hr><h3 id="方法一-容器自身设置自动重启" tabindex="-1"><a class="header-anchor" href="#方法一-容器自身设置自动重启"><span>方法一：容器自身设置自动重启</span></a></h3><p>Docker 支持容器自带重启策略。推荐使用 <code>--restart</code> 参数来创建容器：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>常用参数说明：</p><ul><li><code>no</code>：默认值，容器不会自动重启。</li><li><code>on-failure</code>：只有容器异常退出（非 0 状态码）才重启。</li><li><code>always</code>：无论什么原因退出都重启。</li><li><code>unless-stopped</code>：总是重启，除非手动停止。</li></ul><p>你可以用以下命令重新设置已有容器：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">容器名或I</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">D&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样所有设置了 <code>always</code> 或 <code>unless-stopped</code> 的容器会在 Docker 服务启动后自动启动。</p><hr><h3 id="方法二-设置-docker-服务自启动" tabindex="-1"><a class="header-anchor" href="#方法二-设置-docker-服务自启动"><span>方法二：设置 Docker 服务自启动</span></a></h3><p>确保 Docker 服务本身随系统启动：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样 Docker 服务会随系统启动。</p><hr><h3 id="方法三-编写-systemd-服务或启动脚本" tabindex="-1"><a class="header-anchor" href="#方法三-编写-systemd-服务或启动脚本"><span>方法三：编写 systemd 服务或启动脚本</span></a></h3><p>如果有特殊需求（比如只重启部分容器或者要执行自定义脚本），可以写 systemd 单元或在 <code>/etc/rc.local</code> 里添加：</p><p><strong>编辑 <code>/etc/rc.local</code>：</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -q</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">exit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>记得给 <code>/etc/rc.d/rc.local</code> 加执行权限：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/rc.d/rc.local</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>CentOS 7 之后需要启用 rc-local 服务：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rc-local</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rc-local</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="推荐做法" tabindex="-1"><a class="header-anchor" href="#推荐做法"><span>推荐做法</span></a></h3><p><strong>最佳实践是：</strong></p><ol><li>给所有需要开机自启的容器设置 <code>--restart=always</code> 或 <code>--restart=unless-stopped</code>。</li><li>确保 Docker 服务已设置自启动。</li></ol><hr><p>如需批量设置：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -q</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><p>如有特殊场景请补充，或需要脚本/定制 systemd 文件可告知！</p><hr><h2 id="对于-docker-compose-启动的容器设置开机自动重启" tabindex="-1"><a class="header-anchor" href="#对于-docker-compose-启动的容器设置开机自动重启"><span>对于 docker compose 启动的容器设置开机自动重启</span></a></h2><p>对于 <strong>通过 Docker Compose 启动的容器</strong>，推荐的做法略有不同：</p><hr><h3 id="_1-docker-compose-的容器重启策略" tabindex="-1"><a class="header-anchor" href="#_1-docker-compose-的容器重启策略"><span>1. Docker Compose 的容器重启策略</span></a></h3><p>在 <code>docker-compose.yml</code> 文件里，可以为每个服务单独设置 <code>restart</code> 策略。例如：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">your_image</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  db</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysql</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">unless-stopped</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，<strong>只要 Docker 服务启动，所有设置了 restart 策略的容器都会自动启动，无需单独用 <code>docker update</code> 命令。</strong></p><hr><h3 id="_2-docker-update-适用于普通-docker-run-容器" tabindex="-1"><a class="header-anchor" href="#_2-docker-update-适用于普通-docker-run-容器"><span>2. <code>docker update</code> 适用于普通 docker run 容器</span></a></h3><p>你提到的脚本：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -q</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个命令会<strong>批量为所有已创建的容器设置重启策略</strong>，包括通过 Compose 启动的容器（它们本质上也是普通容器）。但是：</p><ul><li><strong>如果你用 Compose 管理容器，建议直接在 <code>docker-compose.yml</code> 中设置</strong>，维护性更好。</li><li>用 <code>docker update</code> 修改重启策略后，<strong>如果以后用 Compose 重新 up 或重建，可能会被 <code>docker-compose.yml</code> 里的配置覆盖</strong>。</li></ul><hr><h3 id="_3-docker-compose-服务自启动" tabindex="-1"><a class="header-anchor" href="#_3-docker-compose-服务自启动"><span>3. Docker Compose 服务自启动</span></a></h3><p>确保 Docker 服务随系统启动，然后用以下方式（任选其一）让 Compose 项目自动启动：</p><h4 id="方法一-用-restart-策略-服务随-docker-启动自动恢复。" tabindex="-1"><a class="header-anchor" href="#方法一-用-restart-策略-服务随-docker-启动自动恢复。"><span>方法一：用 <code>restart</code> 策略，服务随 Docker 启动自动恢复。</span></a></h4><p>只需在 <code>docker-compose.yml</code> 里配置好 <code>restart</code>，无需手动运行脚本。</p><h4 id="方法二-写-systemd-或-rc-local-启动-compose-项目" tabindex="-1"><a class="header-anchor" href="#方法二-写-systemd-或-rc-local-启动-compose-项目"><span>方法二：写 systemd 或 rc.local 启动 Compose 项目</span></a></h4><p>比如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /path/to/docker-compose.yml</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>可以写 systemd 单元或在 <code>/etc/rc.local</code> 里加上这句，确保系统启动时自动执行。</p><hr><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><ul><li><strong>推荐在 <code>docker-compose.yml</code> 里为每个服务设置 <code>restart</code> 策略。</strong></li><li>不建议用脚本批量 <code>docker update</code>，除非你所有容器都是手动 <code>docker run</code> 创建的。</li><li>如果需要 Compose 项目整体自启动，可以写 systemd 或 rc.local 自动执行 <code>docker compose up -d</code>。</li></ul><p>如需 systemd 服务或 rc.local 脚本样例，可随时告诉我！</p>',61)])])}]]),l=JSON.parse('{"path":"/deploy/environment/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AFdocker%E5%AE%B9%E5%99%A8.html","title":"自动重启所有docker容器","lang":"zh-CN","frontmatter":{"article":false,"title":"自动重启所有docker容器","icon":"ix:reboot","order":1,"description":"设置开机自动重启所有 Docker 容器 在 CentOS 系统上设置开机后自动重启所有 Docker 容器，可以通过以下几种方式实现： 方法一：容器自身设置自动重启 Docker 支持容器自带重启策略。推荐使用 --restart 参数来创建容器： 常用参数说明： no：默认值，容器不会自动重启。 on-failure：只有容器异常退出（非 0 状态...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"自动重启所有docker容器\\",\\"description\\":\\"设置开机自动重启所有 Docker 容器 在 CentOS 系统上设置开机后自动重启所有 Docker 容器，可以通过以下几种方式实现： 方法一：容器自身设置自动重启 Docker 支持容器自带重启策略。推荐使用 --restart 参数来创建容器： 常用参数说明： no：默认值，容器不会自动重启。 on-failure：只有容器异常退出（非 0 状态...\\"}"],["meta",{"property":"og:url","content":"https://newzone.top/deploy/environment/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AFdocker%E5%AE%B9%E5%99%A8.html"}],["meta",{"property":"og:site_name","content":"学习笔记"}],["meta",{"property":"og:title","content":"自动重启所有docker容器"}],["meta",{"property":"og:description","content":"设置开机自动重启所有 Docker 容器 在 CentOS 系统上设置开机后自动重启所有 Docker 容器，可以通过以下几种方式实现： 方法一：容器自身设置自动重启 Docker 支持容器自带重启策略。推荐使用 --restart 参数来创建容器： 常用参数说明： no：默认值，容器不会自动重启。 on-failure：只有容器异常退出（非 0 状态..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-19T09:40:25.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-19T09:40:25.000Z"}]]},"git":{"createdTime":1760866825000,"updatedTime":1760866825000,"contributors":[{"name":"SDF001","username":"SDF001","email":"1026619596@qq.com","commits":1,"url":"https://github.com/SDF001"}]},"readingTime":{"minutes":3,"words":900},"filePathRelative":"deploy/environment/开机自动重启docker容器.md","excerpt":"<h2>设置开机自动重启所有 Docker 容器</h2>\\n<p>在 CentOS 系统上设置开机后自动重启所有 Docker 容器，可以通过以下几种方式实现：</p>\\n<hr>\\n<h3>方法一：容器自身设置自动重启</h3>\\n<p>Docker 支持容器自带重启策略。推荐使用 <code>--restart</code> 参数来创建容器：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">docker</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> run</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> --restart=always</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ...</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);