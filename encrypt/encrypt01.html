<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”’ åŠ å¯† 1</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    /* å†…è”æ ·å¼ï¼Œç¡®ä¿å¯†ç è¾“å…¥æ¡†æ­£å¸¸æ˜¾ç¤º */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .password-input {
      width: 100%;
      padding: 0.8rem;
      margin: 1rem 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 16px;
    }
    .remember-password {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin: 0.8rem 0;
      font-size: 0.9rem;
      color: #666;
    }
    .remember-password input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    .remember-password label {
      cursor: pointer;
    }
    .btn-group {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
    }
    .confirm-btn, .reset-btn {
      flex: 1;
      padding: 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .confirm-btn {
      background: #42b983;
      color: #fff;
    }
    .confirm-btn:hover {
      background: #369870;
    }
    .reset-btn {
      background: #f0f0f0;
      color: #333;
    }
    .reset-btn:hover {
      background: #e0e0e0;
    }
    .error-tip {
      color: #ff4757;
      margin: 0.5rem 0;
      font-size: 0.9rem;
    }
    .count-tip {
      color: #ffa502;
      font-size: 0.8rem;
      margin: 0.5rem 0;
    }
    .access-hint {
      text-align: center;
      padding: 2rem;
      color: #666;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    }
    #app {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="password-protected">
      <div class="modal" id="passwordModal">
        <div class="modal-content">
          <h3>è¯·è¾“å…¥è®¿é—®å¯†ç </h3>
          <input
            type="password"
            id="passwordInput"
            placeholder="è¾“å…¥å¯†ç åæŸ¥çœ‹å†…å®¹"
            class="password-input"
            onkeyup="if(event.key==='Enter') verifyPassword()"
          />
          <div class="remember-password">
            <input type="checkbox" id="remember" />
            <label for="remember">è®°ä½å¯†ç ï¼ˆ7å¤©æœ‰æ•ˆï¼‰</label>
          </div>
          <div class="btn-group">
            <button onclick="verifyPassword()" class="confirm-btn">ç¡®è®¤</button>
            <button onclick="document.getElementById('passwordInput').value=''" class="reset-btn">æ¸…ç©º</button>
          </div>
          <p class="error-tip" id="errorTip" style="display: none;"></p>
          <p class="count-tip">å‰©ä½™å°è¯•æ¬¡æ•°ï¼š<span id="remainingTimes">3</span></p>
        </div>
      </div>

      <div class="access-hint">
        <p>ğŸ”’ æœ¬é¡µé¢ä¸ºåŠ å¯†å†…å®¹ï¼Œè¯·è¾“å…¥æ­£ç¡®çš„è®¿é—®å¯†ç ã€‚</p>
        <p>ğŸ’¾ å‹¾é€‰"è®°ä½å¯†ç "åï¼Œ7å¤©å†…æ— éœ€é‡æ–°è¾“å…¥ã€‚</p>
      </div>
    </div>
  </div>

  <script>
    // é…ç½®
    const CONFIG = {
      encryptedContent: `XG7wO8wdHAs5TUzx5kVogz10TqY036dx69xxlmHnjGGrmJq+mPHejuoohJkGpDkJHvebdwfgqs6q3j5UbPjO1hSpMfiL+63svGDpZ3oAQ1hB7nFzDrl9EgmPLWimwVRM59EyP+4yZyJK+WovPmktLAIV+rhIdPibM9Ppz75l28UNoBfje9Eyf2dZ2Yz/JFxMTiang3OotkFaGKeWzw/Djz+8RlERPzvT1fOOo4dMJZ4OQDZrJuGpPrRhjM0hwYQFsznYxy4zIrRtItRGUIJtxUNYd21uyI4UDdkrJ2dMKD30lLzFl1ba7d8DMXiIA4IoKZsogU+2T7ULQzLLqVi14NKyWmJGSODq/gaCqNNghe6wZUuqunsYWJP3Y9/jLGouu/0q4eXn5Df9eL2HsWE79Z48LglaSnOJnp8lOrPRJWXRA1cxFLBZXOsZ9LJCj9wFlVQM6oL2gLRaGcq1FTcPQOdZzGJWwy3w3bM4Sc88/Xv2eHSuTOxBGJDaTAbjgMVxU8UV9MOki+1r9RBgN2XPJJSucJ7UrnydwfLjOrckNvQ0txdj7Y2B4+TDkKwOz513EQcEp4prMV2z7VQlDLh2TXVZWODQnAf02oETeoHVgnq/G7VN2nidDDo1CbdLM+tHGQzlwTOFc7pgMwBXBqTYg97hLUYqaGP01bsJQAkflfRBhOB6GUdNcYJG0a/jlGN+jnXF8AeCDJu6QSmWsu6atHkdMeITKTvDRswAaYu6zAukyAAOsyCDR/mJCSTCCCK1/IrXvuVUrZMwPmhfJKWwZBpMQ4AaH06lhX8tFCRPxVL2ZB1D+8cLkbIzddZ2SvACNh93zyubBVc4hOCNXv8BTaPrP/hwRKmtSC0/hMxcj+N26fhUYbDN+q6ua39DtyLlgLMKiYR3BHKebRhJt3DgqEoNEoyT9lNfxohl+hUBaI0fT0Ez7i0QJr3ZuK22PL/Dql++It2Ymbi5vUcflbnYq3cgNjU15/NVYzBIDTk/5i0uaA346tY8bRsNkOKCqs4QYkoeGvwp0Rz9/EngWmh0MIaOJ2wvFnGKB/X4HHQMJ8J5oxEEFZrEpmG9Um1UPOVJ03pp533clqimBNTgjnvrsjTJxRMIUQ/GHOttx58f0lkFGB1D8cPmMOeks0NTlCqLx14u3aOorBGw3bvTsXjcTQ==`,
      originalPath: '/encrypt/encrypt01.html',
      iv: 'R7NTHazlPUSciblN', // ä¸ç¯å¢ƒå˜é‡ AES_IV ä¿æŒä¸€è‡´
      maxRetries: 3
    };

    // ç§»é™¤é¡µé¢ä¸­çš„å›¾æ ‡å…ƒç´ 
    function removePageIcons() {
      // ç§»é™¤ä¾§è¾¹æ é“¾æ¥ä¸­çš„å›¾æ ‡
      const sidebarLinks = document.querySelectorAll('.vp-sidebar-link');
      sidebarLinks.forEach(link => {
        const iconElements = link.querySelectorAll('iconify-icon');
        iconElements.forEach(icon => icon.remove());
      });

      // ç§»é™¤é¡µé¢æ ‡é¢˜ä¸­çš„å›¾æ ‡
      const titleIcons = document.querySelectorAll('h1 iconify-icon');
      titleIcons.forEach(icon => icon.remove());

      // ç§»é™¤é¡µé¢ä¸­çš„æ‰€æœ‰å…¶ä»–å›¾æ ‡å…ƒç´ 
      const allIcons = document.querySelectorAll('iconify-icon');
      allIcons.forEach(icon => icon.remove());
    }

    // å…¨å±€å˜é‡
    let remainingTimes = CONFIG.maxRetries;

    // å¯†ç å¡«å……å‡½æ•°ï¼ˆä¸åŠ å¯†æ—¶ä¿æŒä¸€è‡´ï¼‰
    function padKeyTo32Bytes(key) {
      if (key.length >= 32) {
        return key.substring(0, 32);
      }
      let paddedKey = key;
      while (paddedKey.length < 32) {
        paddedKey += key;
      }
      return paddedKey.substring(0, 32);
    }

    // åŠ å¯†å¯†ç ç”¨äºå­˜å‚¨
    function encryptPasswordForStorage(password) {
      try {
        const storageKey = 'vuepress_storage_key_2024';
        const storageIv = 'storage_iv_16byte';

        const paddedKey = padKeyTo32Bytes(storageKey);
        const key = CryptoJS.enc.Utf8.parse(paddedKey);
        const iv = CryptoJS.enc.Utf8.parse(storageIv);

        const encrypted = CryptoJS.AES.encrypt(password, key, {
          iv: iv,
          mode: CryptoJS.mode.CBC,
          padding: CryptoJS.pad.Pkcs7
        });

        return encrypted.toString();
      } catch (error) {
        console.warn('å¯†ç åŠ å¯†å¤±è´¥:', error);
        return null;
      }
    }

    // è§£å¯†å­˜å‚¨çš„å¯†ç 
    function decryptPasswordFromStorage(encryptedPassword) {
      try {
        const storageKey = 'vuepress_storage_key_2024';
        const storageIv = 'storage_iv_16byte';

        const paddedKey = padKeyTo32Bytes(storageKey);
        const key = CryptoJS.enc.Utf8.parse(paddedKey);
        const iv = CryptoJS.enc.Utf8.parse(storageIv);

        const decrypted = CryptoJS.AES.decrypt(encryptedPassword, key, {
          iv: iv,
          mode: CryptoJS.mode.CBC,
          padding: CryptoJS.pad.Pkcs7
        });

        const decryptedStr = CryptoJS.enc.Utf8.stringify(decrypted);
        return decryptedStr;
      } catch (error) {
        console.warn('å¯†ç è§£å¯†å¤±è´¥:', error);
        return null;
      }
    }

    // éªŒè¯å¯†ç å¹¶è§£å¯†å†…å®¹
    function verifyPassword() {
      const inputPassword = document.getElementById('passwordInput').value;
      const errorTip = document.getElementById('errorTip');
      const remainingTimesSpan = document.getElementById('remainingTimes');

      if (!inputPassword) {
        showError('è¯·è¾“å…¥å¯†ç ï¼');
        return;
      }

      try {
        // è°ƒè¯•ä¿¡æ¯
        console.log('ğŸ” å¼€å§‹å¯†ç éªŒè¯');
        console.log('è¾“å…¥å¯†ç :', inputPassword);
        console.log('å¯†ç é•¿åº¦:', inputPassword.length);

        // é…ç½®AESè§£å¯†å‚æ•°
        const paddedKey = padKeyTo32Bytes(inputPassword);
        console.log('å¡«å……åå¯†é’¥:', paddedKey);
        console.log('å¡«å……åå¯†é’¥é•¿åº¦:', paddedKey.length);

        const key = CryptoJS.enc.Utf8.parse(paddedKey);
        const iv = CryptoJS.enc.Utf8.parse(CONFIG.iv);
        console.log('IV:', CONFIG.iv);

        // æ‰§è¡Œè§£å¯†
        const decrypted = CryptoJS.AES.decrypt(
          CONFIG.encryptedContent,
          key,
          { iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
        );

        console.log('è§£å¯†å¯¹è±¡:', decrypted.toString());
        console.log('è§£å¯†å¯¹è±¡ç±»å‹:', typeof decrypted.toString());

        // è½¬æ¢è§£å¯†ç»“æœä¸ºå­—ç¬¦ä¸²
        const decryptedStr = CryptoJS.enc.Utf8.stringify(decrypted);
        console.log('è§£å¯†å­—ç¬¦ä¸²:', decryptedStr);
        console.log('è§£å¯†å­—ç¬¦ä¸²é•¿åº¦:', decryptedStr.length);
        console.log('è§£å¯†å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º:', !decryptedStr);
        console.log('è§£å¯†å­—ç¬¦ä¸²trimåæ˜¯å¦ä¸ºç©º:', decryptedStr.trim() === '');

        // æ£€æŸ¥è§£å¯†ç»“æœ
        console.log('ğŸ” æ£€æŸ¥è§£å¯†ç»“æœæ¡ä»¶:');
        console.log('!decryptedStr:', !decryptedStr);
        console.log('decryptedStr.trim() === "":', decryptedStr.trim() === '');
        console.log('æ¡ä»¶ç»“æœ:', !decryptedStr || decryptedStr.trim() === '');

        if (!decryptedStr || decryptedStr.trim() === '') {
          console.log('âŒ è¿›å…¥é”™è¯¯å¤„ç†åˆ†æ”¯');
          handleError();
          return;
        } else {
          console.log('âœ… è§£å¯†éªŒè¯é€šè¿‡ï¼Œè¿›å…¥æˆåŠŸå¤„ç†åˆ†æ”¯');
        }

        // è§£å¯†æˆåŠŸï¼šä¿å­˜å¯†ç ï¼ˆå¦‚æœéœ€è¦ï¼‰å¹¶æ˜¾ç¤ºå†…å®¹
        console.log('ğŸ” å¼€å§‹æˆåŠŸå¤„ç†åˆ†æ”¯');

        if (document.getElementById('remember').checked) {
          console.log('ğŸ’¾ ä¿å­˜å¯†ç åˆ°æœ¬åœ°å­˜å‚¨');
          savePassword(inputPassword);
        } else {
          console.log('ğŸ”“ ä¸ä¿å­˜å¯†ç ');
        }

        console.log('ğŸ”„ å¼€å§‹æ›¿æ¢é¡µé¢å†…å®¹');
        // ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼æ›¿æ¢é¡µé¢å†…å®¹
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = decryptedStr;
        console.log('ğŸ“ åˆ›å»ºä¸´æ—¶å®¹å™¨ï¼Œå†…å®¹é•¿åº¦:', decryptedStr.length);

        // æ›¿æ¢æ•´ä¸ª body å†…å®¹
        const bodyContent = tempDiv.querySelector('body');
        if (bodyContent) {
          console.log('ğŸ“„ æ‰¾åˆ°bodyå…ƒç´ ï¼Œå¼€å§‹æ›¿æ¢');
          document.body.innerHTML = bodyContent.innerHTML;
          console.log('âœ… bodyå†…å®¹æ›¿æ¢å®Œæˆ');
        } else {
          console.log('âŒ æœªæ‰¾åˆ°bodyå…ƒç´ ');
        }

        // æ›´æ–°é¡µé¢æ ‡é¢˜
        const newTitle = tempDiv.querySelector('title');
        if (newTitle) {
          console.log('ğŸ·ï¸ æ›´æ–°é¡µé¢æ ‡é¢˜ä¸º:', newTitle.textContent);
          document.title = newTitle.textContent;
        } else {
          console.log('âš ï¸ æœªæ‰¾åˆ°æ ‡é¢˜å…ƒç´ ');
        }

        console.log('âœ… æˆåŠŸå¤„ç†åˆ†æ”¯å®Œæˆ');

        // æ‰§è¡Œæ–°å†…å®¹ä¸­çš„è„šæœ¬
        const scripts = tempDiv.querySelectorAll('script');
        scripts.forEach(script => {
          const newScript = document.createElement('script');
          if (script.src) {
            newScript.src = script.src;
          } else {
            newScript.textContent = script.textContent;
          }
          document.head.appendChild(newScript);
        });

        // è§£å¯†å®Œæˆåç«‹å³ç§»é™¤é¡µé¢ä¸­çš„å›¾æ ‡å…ƒç´ 
        setTimeout(() => {
          removePageIcons();
        }, 100);

      } catch (err) {
        handleError();
      }
    }

    // å¤„ç†è§£å¯†å¤±è´¥
    function handleError() {
      remainingTimes--;
      const remainingTimesSpan = document.getElementById('remainingTimes');
      remainingTimesSpan.textContent = remainingTimes;

      if (remainingTimes <= 0) {
        showError('å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼');
        document.getElementById('passwordInput').disabled = true;
      } else {
        showError(`å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼`);
        document.getElementById('passwordInput').value = '';
      }
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
      const errorTip = document.getElementById('errorTip');
      errorTip.textContent = message;
      errorTip.style.display = 'block';

      setTimeout(() => {
        errorTip.style.display = 'none';
      }, 5000);
    }

    // ä¿å­˜å¯†ç åˆ° localStorage
    function savePassword(password) {
      try {
        const encryptedPassword = encryptPasswordForStorage(password);
        if (encryptedPassword) {
          const savedPasswords = JSON.parse(localStorage.getItem('vuepress_encrypted_passwords_') || '{}');
          savedPasswords['universal_aes_key'] = {
            encryptedPassword: encryptedPassword,
            timestamp: Date.now()
          };
          localStorage.setItem('vuepress_encrypted_passwords_', JSON.stringify(savedPasswords));
        }
      } catch (error) {
        console.warn('ä¿å­˜åŠ å¯†å¯†ç å¤±è´¥:', error);
      }
    }

    // å°è¯•ä½¿ç”¨ä¿å­˜çš„å¯†ç 
    function trySavedPassword() {
      try {
        const savedPasswords = JSON.parse(localStorage.getItem('vuepress_encrypted_passwords_') || '{}');
        const savedData = savedPasswords['universal_aes_key'];

        if (savedData && savedData.encryptedPassword) {
          // æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼ˆ7å¤©ï¼‰
          const now = Date.now();
          const weekInMs = 7 * 24 * 60 * 60 * 1000;
          if (now - savedData.timestamp < weekInMs) {
            const decryptedPassword = decryptPasswordFromStorage(savedData.encryptedPassword);
            if (decryptedPassword) {
              document.getElementById('passwordInput').value = decryptedPassword;
              document.getElementById('remember').checked = true;
              verifyPassword();
              return;
            }
          }
        }
      } catch (error) {
        console.warn('è¯»å–ä¿å­˜çš„å¯†ç å¤±è´¥:', error);
      }
    }

    // é¡µé¢åŠ è½½æ—¶å°è¯•ä½¿ç”¨ä¿å­˜çš„å¯†ç 
    window.addEventListener('DOMContentLoaded', trySavedPassword);
  </script>

  <style>
    /* å¼¹çª—æ ·å¼ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .password-input {
      width: 100%;
      padding: 0.8rem;
      margin: 1rem 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .remember-password {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin: 0.8rem 0;
      font-size: 0.9rem;
      color: #666;
    }
    .remember-password input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    .remember-password label {
      cursor: pointer;
    }
    .btn-group {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
    }
    .confirm-btn, .reset-btn {
      flex: 1;
      padding: 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .confirm-btn {
      background: #42b983;
      color: #fff;
    }
    .confirm-btn:hover {
      background: #369870;
    }
    .reset-btn {
      background: #f0f0f0;
      color: #333;
    }
    .reset-btn:hover {
      background: #e0e0e0;
    }
    .error-tip {
      color: #ff4757;
      margin: 0.5rem 0;
      font-size: 0.9rem;
    }
    .count-tip {
      color: #ffa502;
      font-size: 0.8rem;
      margin: 0.5rem 0;
    }
    .access-hint {
      text-align: center;
      padding: 2rem;
      color: #666;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    }
    #app {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</body>
</html>